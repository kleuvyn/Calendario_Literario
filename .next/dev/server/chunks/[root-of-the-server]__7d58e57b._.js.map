{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/kleuvyn/Documentos/MeusRepositorios/Calendario_Literario/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL || process.env.POSTGRES_URL,\n  ssl: {\n    rejectUnauthorized: false \n  }\n});\n\nexport async function executeQuery(query: string, params: any[] = []) {\n  try {\n\n    await pool.query('ALTER TABLE users ADD COLUMN IF NOT EXISTS password TEXT;');\n    await pool.query('ALTER TABLE users ADD COLUMN IF NOT EXISTS image TEXT;');\n    await pool.query('ALTER TABLE reading_data ADD COLUMN IF NOT EXISTS author TEXT;');\n    await pool.query('ALTER TABLE reading_data ADD COLUMN IF NOT EXISTS rating INTEGER;');\n    await pool.query('ALTER TABLE reading_data ADD COLUMN IF NOT EXISTS cover_url TEXT;');\n    await pool.query('ALTER TABLE reading_data ADD COLUMN IF NOT EXISTS email TEXT;');\n\n    const result = await pool.query(query, params);\n    return result.rows; \n  } catch (error) {\n    console.error('Erro detalhado no Banco de Dados:', error);\n    throw error;\n  }\n}"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY,IAAI,QAAQ,GAAG,CAAC,YAAY;IACtE,KAAK;QACH,oBAAoB;IACtB;AACF;AAEO,eAAe,aAAa,KAAa,EAAE,SAAgB,EAAE;IAClE,IAAI;QAEF,MAAM,KAAK,KAAK,CAAC;QACjB,MAAM,KAAK,KAAK,CAAC;QACjB,MAAM,KAAK,KAAK,CAAC;QACjB,MAAM,KAAK,KAAK,CAAC;QACjB,MAAM,KAAK,KAAK,CAAC;QACjB,MAAM,KAAK,KAAK,CAAC;QAEjB,MAAM,SAAS,MAAM,KAAK,KAAK,CAAC,OAAO;QACvC,OAAO,OAAO,IAAI;IACpB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qCAAqC;QACnD,MAAM;IACR;AACF"}},
    {"offset": {"line": 162, "column": 0}, "map": {"version":3,"sources":["file:///home/kleuvyn/Documentos/MeusRepositorios/Calendario_Literario/lib/auth.ts"],"sourcesContent":["import { NextAuthOptions } from \"next-auth\";\nimport GoogleProvider from \"next-auth/providers/google\";\nimport CredentialsProvider from \"next-auth/providers/credentials\";\nimport { executeQuery } from \"@/lib/db\";\nimport bcrypt from \"bcrypt\";\n\nexport const authOptions: NextAuthOptions = {\n  providers: [\n    GoogleProvider({\n      clientId: process.env.GOOGLE_CLIENT_ID!,\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\n      authorization: { params: { prompt: \"select_account\" } },\n      allowDangerousEmailAccountLinking: true, \n    }),\n    CredentialsProvider({\n      name: \"Credentials\",\n      credentials: {\n        email: { label: \"Email\", type: \"text\" },\n        password: { label: \"Password\", type: \"password\" }\n      },\n      async authorize(credentials) {\n        if (!credentials?.email || !credentials?.password) return null;\n        const users = await executeQuery(\"SELECT * FROM users WHERE email = $1\", [credentials.email]) as any[];\n        const user = users[0];\n        if (user && user.password && await bcrypt.compare(credentials.password, user.password)) {\n          return { id: user.id.toString(), name: user.name, email: user.email, image: user.image };\n        }\n        return null;\n      }\n    }),\n  ],\n  callbacks: {\n    async jwt({ token, user }) {\n      if (user) token.id = user.id;\n      return token;\n    },\n    async session({ session, token }) {\n      if (session.user) (session.user as any).id = token.id;\n      return session;\n    },\n    async signIn({ user, account }) {\n      if (account?.provider === \"google\") {\n        await executeQuery(\n          `INSERT INTO users (name, email, image) VALUES ($1, $2, $3) \n           ON CONFLICT (email) DO UPDATE SET name = $1`, \n          [user.name, user.email, user.image]\n        );\n      }\n      return true;\n    }\n  },\n  session: { strategy: \"jwt\" },\n  secret: process.env.NEXTAUTH_SECRET,\n  pages: { signIn: '/' }\n};"],"names":[],"mappings":";;;;AACA;AACA;AACA;AACA;;;;;;;;;AAEO,MAAM,cAA+B;IAC1C,WAAW;QACT,IAAA,gKAAc,EAAC;YACb,UAAU,QAAQ,GAAG,CAAC,gBAAgB;YACtC,cAAc,QAAQ,GAAG,CAAC,oBAAoB;YAC9C,eAAe;gBAAE,QAAQ;oBAAE,QAAQ;gBAAiB;YAAE;YACtD,mCAAmC;QACrC;QACA,IAAA,qKAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAO;gBACtC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU,OAAO;gBAC1D,MAAM,QAAQ,MAAM,IAAA,2HAAY,EAAC,wCAAwC;oBAAC,YAAY,KAAK;iBAAC;gBAC5F,MAAM,OAAO,KAAK,CAAC,EAAE;gBACrB,IAAI,QAAQ,KAAK,QAAQ,IAAI,MAAM,gHAAM,CAAC,OAAO,CAAC,YAAY,QAAQ,EAAE,KAAK,QAAQ,GAAG;oBACtF,OAAO;wBAAE,IAAI,KAAK,EAAE,CAAC,QAAQ;wBAAI,MAAM,KAAK,IAAI;wBAAE,OAAO,KAAK,KAAK;wBAAE,OAAO,KAAK,KAAK;oBAAC;gBACzF;gBACA,OAAO;YACT;QACF;KACD;IACD,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM,MAAM,EAAE,GAAG,KAAK,EAAE;YAC5B,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,IAAI,QAAQ,IAAI,EAAE,AAAC,QAAQ,IAAI,CAAS,EAAE,GAAG,MAAM,EAAE;YACrD,OAAO;QACT;QACA,MAAM,QAAO,EAAE,IAAI,EAAE,OAAO,EAAE;YAC5B,IAAI,SAAS,aAAa,UAAU;gBAClC,MAAM,IAAA,2HAAY,EAChB,CAAC;sDAC2C,CAAC,EAC7C;oBAAC,KAAK,IAAI;oBAAE,KAAK,KAAK;oBAAE,KAAK,KAAK;iBAAC;YAEvC;YACA,OAAO;QACT;IACF;IACA,SAAS;QAAE,UAAU;IAAM;IAC3B,QAAQ,QAAQ,GAAG,CAAC,eAAe;IACnC,OAAO;QAAE,QAAQ;IAAI;AACvB"}},
    {"offset": {"line": 256, "column": 0}, "map": {"version":3,"sources":["file:///home/kleuvyn/Documentos/MeusRepositorios/Calendario_Literario/app/api/user/delete-account/route.ts"],"sourcesContent":["export const dynamic = \"force-dynamic\";\n\nimport { NextResponse } from \"next/server\";\nimport { executeQuery } from \"@/lib/db\";\nimport { getServerSession } from \"next-auth/next\"; \nimport { authOptions } from \"@/lib/auth\"; \n\nexport async function DELETE() {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user?.email) {\n      return NextResponse.json({ error: \"Não autorizado\" }, { status: 401 });\n    }\n\n    const email = session.user.email;\n    const userResult = await executeQuery(\n      \"SELECT id FROM public.users WHERE email = $1\",\n      [email]\n    ) as any[];\n\n    if (userResult.length > 0) {\n      const userId = userResult[0].id;\n\n      await executeQuery(\"DELETE FROM public.book_reviews WHERE user_id = $1\", [userId]).catch(e => console.log(\"Erro na tabela book_reviews:\", e.message));\n      \n      await executeQuery(\"DELETE FROM public.reading_data WHERE user_id = $1 OR email = $2\", [userId, email]).catch(e => console.log(\"Erro na tabela reading_data:\", e.message));\n      \n      try {\n          await executeQuery(\"DELETE FROM public.books WHERE user_id = $1\", [userId]);\n      } catch (e) {\n          console.log(\"Tentativa 1 em 'books' falhou, tentando por email...\");\n          try {\n              await executeQuery(\"DELETE FROM public.books WHERE user_email = $1\", [email]);\n          } catch (e2) {\n              console.log(\"Aviso: Não foi possível limpar a tabela 'books'. Verifique o nome da coluna de usuário.\");\n          }\n      }\n      \n      await executeQuery(\"DELETE FROM public.users WHERE id = $1\", [userId]);\n      \n      console.log(`LGPD: Limpeza concluída para ${email}`);\n    }\n\n    return NextResponse.json({ success: true });\n\n  } catch (error: any) {\n    console.error(\"ERRO FINAL NO DELETE:\", error.message);\n    return NextResponse.json({ error: \"Erro interno no servidor\", details: error.message }, { status: 500 });\n  }\n}"],"names":[],"mappings":";;;;;;AAEA;AACA;AACA;AACA;;;;;;AALO,MAAM,UAAU;;;;;AAOhB,eAAe;IACpB,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,mKAAgB,EAAC,4HAAW;QAElD,IAAI,CAAC,SAAS,MAAM,OAAO;YACzB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,MAAM,QAAQ,QAAQ,IAAI,CAAC,KAAK;QAChC,MAAM,aAAa,MAAM,IAAA,2HAAY,EACnC,gDACA;YAAC;SAAM;QAGT,IAAI,WAAW,MAAM,GAAG,GAAG;YACzB,MAAM,SAAS,UAAU,CAAC,EAAE,CAAC,EAAE;YAE/B,MAAM,IAAA,2HAAY,EAAC,sDAAsD;gBAAC;aAAO,EAAE,KAAK,CAAC,CAAA,IAAK,QAAQ,GAAG,CAAC,gCAAgC,EAAE,OAAO;YAEnJ,MAAM,IAAA,2HAAY,EAAC,oEAAoE;gBAAC;gBAAQ;aAAM,EAAE,KAAK,CAAC,CAAA,IAAK,QAAQ,GAAG,CAAC,gCAAgC,EAAE,OAAO;YAExK,IAAI;gBACA,MAAM,IAAA,2HAAY,EAAC,+CAA+C;oBAAC;iBAAO;YAC9E,EAAE,OAAO,GAAG;gBACR,QAAQ,GAAG,CAAC;gBACZ,IAAI;oBACA,MAAM,IAAA,2HAAY,EAAC,kDAAkD;wBAAC;qBAAM;gBAChF,EAAE,OAAO,IAAI;oBACT,QAAQ,GAAG,CAAC;gBAChB;YACJ;YAEA,MAAM,IAAA,2HAAY,EAAC,0CAA0C;gBAAC;aAAO;YAErE,QAAQ,GAAG,CAAC,CAAC,6BAA6B,EAAE,OAAO;QACrD;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAE3C,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,yBAAyB,MAAM,OAAO;QACpD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAA4B,SAAS,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACxG;AACF"}}]
}