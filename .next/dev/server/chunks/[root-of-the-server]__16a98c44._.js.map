{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/kleuvyn/Documentos/MeusRepositorios/Calendario_Literario/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\n\n// Criamos o pool apenas uma vez (Singleton) para não esgotar as conexões do banco\nconst pool = new Pool({\n  host: process.env.DB_HOST,\n  port: parseInt(process.env.DB_PORT || '5432'),\n  database: process.env.DB_NAME,\n  user: process.env.DB_USER,\n  password: process.env.DB_PASSWORD,\n  // Adicione isso se estiver usando bancos na nuvem como Neon ou Render\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function executeQuery(query: string, params: any[] = []) {\n  try {\n    const result = await pool.query(query, params);\n    return result.rows; // Retorna apenas as linhas dos dados\n  } catch (error) {\n    console.error('Erro no Banco de Dados:', error);\n    throw error;\n  }\n}"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,kFAAkF;AAClF,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,MAAM,QAAQ,GAAG,CAAC,OAAO;IACzB,MAAM,SAAS,QAAQ,GAAG,CAAC,OAAO,IAAI;IACtC,UAAU,QAAQ,GAAG,CAAC,OAAO;IAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO;IACzB,UAAU,QAAQ,GAAG,CAAC,WAAW;IACjC,sEAAsE;IACtE,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,aAAa,KAAa,EAAE,SAAgB,EAAE;IAClE,IAAI;QACF,MAAM,SAAS,MAAM,KAAK,KAAK,CAAC,OAAO;QACvC,OAAO,OAAO,IAAI,EAAE,qCAAqC;IAC3D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,MAAM;IACR;AACF"}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///home/kleuvyn/Documentos/MeusRepositorios/Calendario_Literario/app/api/book-reviews/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport { executeQuery } from \"@/lib/db\"\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const userEmail = searchParams.get(\"email\")\n    const year = searchParams.get(\"year\")\n    const month = searchParams.get(\"month\")\n\n    if (!userEmail || !year || !month) {\n      return NextResponse.json({ error: \"Email, ano e mês são obrigatórios\" }, { status: 400 })\n    }\n\n    const data = await executeQuery(\n      `SELECT br.* FROM book_reviews br\n       JOIN users u ON br.user_id = u.id\n       WHERE u.email = $1 AND br.year = $2 AND br.month = $3\n       ORDER BY br.created_at`,\n      [userEmail, Number.parseInt(year), Number.parseInt(month)],\n    )\n\n    return NextResponse.json({ data })\n  } catch (error) {\n    console.error(\"Error fetching book reviews:\", error)\n    return NextResponse.json({ error: \"Erro ao buscar livros\" }, { status: 500 })\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { email, year, month, books } = body\n\n    if (!email || !year || !month || !books) {\n      return NextResponse.json({ error: \"Dados incompletos\" }, { status: 400 })\n    }\n\n    const userResult = await executeQuery(\"SELECT id FROM users WHERE email = $1\", [email])\n\n    if (!userResult || userResult.length === 0) {\n      return NextResponse.json({ error: \"Usuário não encontrado\" }, { status: 404 })\n    }\n\n    const userId = userResult[0].id\n\n    await executeQuery(\"DELETE FROM book_reviews WHERE user_id = $1 AND year = $2 AND month = $3\", [\n      userId,\n      year,\n      month,\n    ])\n\n    for (const book of books) {\n      if (book.title || book.coverUrl || book.rating > 0) {\n        await executeQuery(\n          `INSERT INTO book_reviews (user_id, year, month, title, cover_url, rating)\n           VALUES ($1, $2, $3, $4, $5, $6)`,\n          [userId, year, month, book.title || \"\", book.coverUrl || \"\", book.rating || 0],\n        )\n      }\n    }\n\n    return NextResponse.json({ success: true })\n  } catch (error) {\n    console.error(\"Error saving book reviews:\", error)\n    return NextResponse.json({ error: \"Erro ao salvar livros\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,YAAY,aAAa,GAAG,CAAC;QACnC,MAAM,OAAO,aAAa,GAAG,CAAC;QAC9B,MAAM,QAAQ,aAAa,GAAG,CAAC;QAE/B,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,OAAO;YACjC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoC,GAAG;gBAAE,QAAQ;YAAI;QACzF;QAEA,MAAM,OAAO,MAAM,IAAA,2HAAY,EAC7B,CAAC;;;6BAGsB,CAAC,EACxB;YAAC;YAAW,OAAO,QAAQ,CAAC;YAAO,OAAO,QAAQ,CAAC;SAAO;QAG5D,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAK;IAClC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG;QAEtC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,SAAS,CAAC,OAAO;YACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QAEA,MAAM,aAAa,MAAM,IAAA,2HAAY,EAAC,yCAAyC;YAAC;SAAM;QAEtF,IAAI,CAAC,cAAc,WAAW,MAAM,KAAK,GAAG;YAC1C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAyB,GAAG;gBAAE,QAAQ;YAAI;QAC9E;QAEA,MAAM,SAAS,UAAU,CAAC,EAAE,CAAC,EAAE;QAE/B,MAAM,IAAA,2HAAY,EAAC,4EAA4E;YAC7F;YACA;YACA;SACD;QAED,KAAK,MAAM,QAAQ,MAAO;YACxB,IAAI,KAAK,KAAK,IAAI,KAAK,QAAQ,IAAI,KAAK,MAAM,GAAG,GAAG;gBAClD,MAAM,IAAA,2HAAY,EAChB,CAAC;0CAC+B,CAAC,EACjC;oBAAC;oBAAQ;oBAAM;oBAAO,KAAK,KAAK,IAAI;oBAAI,KAAK,QAAQ,IAAI;oBAAI,KAAK,MAAM,IAAI;iBAAE;YAElF;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}