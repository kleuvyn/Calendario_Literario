{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///home/kleuvyn/Documentos/MeusRepositorios/Calendario_Literario/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL || process.env.POSTGRES_URL,\n  ssl: {\n    rejectUnauthorized: false \n  }\n});\n\nexport async function executeQuery(query: string, params: any[] = []) {\n  try {\n\n    await pool.query('ALTER TABLE users ADD COLUMN IF NOT EXISTS password TEXT;');\n    await pool.query('ALTER TABLE users ADD COLUMN IF NOT EXISTS image TEXT;');\n    await pool.query('ALTER TABLE reading_data ADD COLUMN IF NOT EXISTS author TEXT;');\n    await pool.query('ALTER TABLE reading_data ADD COLUMN IF NOT EXISTS rating INTEGER;');\n    await pool.query('ALTER TABLE reading_data ADD COLUMN IF NOT EXISTS cover_url TEXT;');\n    await pool.query('ALTER TABLE reading_data ADD COLUMN IF NOT EXISTS email TEXT;');\n\n    const result = await pool.query(query, params);\n    return result.rows; \n  } catch (error) {\n    console.error('Erro detalhado no Banco de Dados:', error);\n    throw error;\n  }\n}"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY,IAAI,QAAQ,GAAG,CAAC,YAAY;IACtE,KAAK;QACH,oBAAoB;IACtB;AACF;AAEO,eAAe,aAAa,KAAa,EAAE,SAAgB,EAAE;IAClE,IAAI;QAEF,MAAM,KAAK,KAAK,CAAC;QACjB,MAAM,KAAK,KAAK,CAAC;QACjB,MAAM,KAAK,KAAK,CAAC;QACjB,MAAM,KAAK,KAAK,CAAC;QACjB,MAAM,KAAK,KAAK,CAAC;QACjB,MAAM,KAAK,KAAK,CAAC;QAEjB,MAAM,SAAS,MAAM,KAAK,KAAK,CAAC,OAAO;QACvC,OAAO,OAAO,IAAI;IACpB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qCAAqC;QACnD,MAAM;IACR;AACF"}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":["file:///home/kleuvyn/Documentos/MeusRepositorios/Calendario_Literario/app/api/reading-data/route.ts"],"sourcesContent":["import { executeQuery } from \"@/lib/db\";\nimport { NextResponse } from \"next/server\";\n\nexport async function GET(request: Request) {\n  const { searchParams } = new URL(request.url);\n  const email = searchParams.get(\"email\");\n  const year = Number(searchParams.get(\"year\"));\n  const month = Number(searchParams.get(\"month\"));\n\n  if (!email) return NextResponse.json({ data: [] });\n\n  try {\n    let query = `\n      SELECT rd.*, \n             br.rating, \n             br.cover_url, \n             COALESCE(br.total_pages, rd.total_pages) as display_pages\n      FROM public.reading_data rd\n      LEFT JOIN public.book_reviews br ON rd.user_id = br.user_id AND rd.book_name = br.title\n      WHERE (rd.email = $1 OR rd.user_id = (SELECT id FROM public.users WHERE email = $1 LIMIT 1))\n      AND (\n        (rd.status = 'lendo') \n        OR \n        (rd.year = $2 AND rd.month = $3)\n      )\n      ORDER BY rd.status DESC, rd.start_date ASC\n    `;\n    \n    const params = [email, year, month];\n    const rows = await executeQuery(query, params);\n    return NextResponse.json({ data: rows });\n  } catch (error: any) {\n    return NextResponse.json({ error: \"Erro ao carregar dados\" }, { status: 500 });\n  }\n}\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json();\n    const { email, bookName, startDate, endDate, year, month, action, rating, coverUrl, totalPages } = body;\n    const pages = Number(totalPages) || 0;\n\n    const userResult = await executeQuery(`SELECT id FROM public.users WHERE email = $1`, [email]);\n    if (userResult.length === 0) return NextResponse.json({ error: \"Usuário não encontrado\" }, { status: 404 });\n    const userId = userResult[0].id;\n\n    if (action === \"START_READING\") {\n      await executeQuery(`\n        INSERT INTO public.reading_data (email, user_id, book_name, start_date, year, month, status, total_pages)\n        VALUES ($1, $2, $3, $4, $5, $6, 'lendo', 0)\n      `, [email, userId, bookName, startDate, year, month]);\n    } \n    \n    else if (action === \"FINISH_READING\") {\n      await executeQuery(`\n        UPDATE public.reading_data \n        SET end_date = $1, \n            status = 'finalizado', \n            total_pages = $2,\n            month = $6,\n            year = $7\n        WHERE (email = $3 OR user_id = $5) AND book_name = $4 AND status = 'lendo'\n      `, [endDate, pages, email, bookName, userId, month, year]);\n\n      await executeQuery(`\n        INSERT INTO public.book_reviews (user_id, year, month, title, rating, cover_url, total_pages)\n        VALUES ($1, $2, $3, $4, 0, '', $5)\n        ON CONFLICT (user_id, title) DO UPDATE SET \n          year = EXCLUDED.year, \n          month = EXCLUDED.month,\n          total_pages = EXCLUDED.total_pages\n      `, [userId, year, month, bookName, pages]);\n    }\n\n    else if (action === \"UPDATE_REVIEW\") {\n      await executeQuery(`\n        INSERT INTO public.book_reviews (user_id, title, rating, cover_url, total_pages)\n        VALUES ($1, $2, $3, $4, $5)\n        ON CONFLICT (user_id, title) DO UPDATE SET \n          rating = EXCLUDED.rating, \n          cover_url = EXCLUDED.cover_url, \n          total_pages = EXCLUDED.total_pages\n      `, [userId, bookName, rating, coverUrl, pages]);\n\n      await executeQuery(`\n        UPDATE public.reading_data \n        SET total_pages = $1\n        WHERE user_id = $2 AND book_name = $3\n      `, [pages, userId, bookName]);\n    }\n\n    return NextResponse.json({ success: true });\n  } catch (error: any) {\n    return NextResponse.json({ error: error.message }, { status: 500 });\n  }\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;;;;;;;AAEO,eAAe,IAAI,OAAgB;IACxC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,QAAQ,aAAa,GAAG,CAAC;IAC/B,MAAM,OAAO,OAAO,aAAa,GAAG,CAAC;IACrC,MAAM,QAAQ,OAAO,aAAa,GAAG,CAAC;IAEtC,IAAI,CAAC,OAAO,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,MAAM,EAAE;IAAC;IAEhD,IAAI;QACF,IAAI,QAAQ,CAAC;;;;;;;;;;;;;;IAcb,CAAC;QAED,MAAM,SAAS;YAAC;YAAO;YAAM;SAAM;QACnC,MAAM,OAAO,MAAM,IAAA,2HAAY,EAAC,OAAO;QACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,MAAM;QAAK;IACxC,EAAE,OAAO,OAAY;QACnB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAyB,GAAG;YAAE,QAAQ;QAAI;IAC9E;AACF;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,KAAK,EAAE,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,UAAU,EAAE,GAAG;QACnG,MAAM,QAAQ,OAAO,eAAe;QAEpC,MAAM,aAAa,MAAM,IAAA,2HAAY,EAAC,CAAC,4CAA4C,CAAC,EAAE;YAAC;SAAM;QAC7F,IAAI,WAAW,MAAM,KAAK,GAAG,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAyB,GAAG;YAAE,QAAQ;QAAI;QACzG,MAAM,SAAS,UAAU,CAAC,EAAE,CAAC,EAAE;QAE/B,IAAI,WAAW,iBAAiB;YAC9B,MAAM,IAAA,2HAAY,EAAC,CAAC;;;MAGpB,CAAC,EAAE;gBAAC;gBAAO;gBAAQ;gBAAU;gBAAW;gBAAM;aAAM;QACtD,OAEK,IAAI,WAAW,kBAAkB;YACpC,MAAM,IAAA,2HAAY,EAAC,CAAC;;;;;;;;MAQpB,CAAC,EAAE;gBAAC;gBAAS;gBAAO;gBAAO;gBAAU;gBAAQ;gBAAO;aAAK;YAEzD,MAAM,IAAA,2HAAY,EAAC,CAAC;;;;;;;MAOpB,CAAC,EAAE;gBAAC;gBAAQ;gBAAM;gBAAO;gBAAU;aAAM;QAC3C,OAEK,IAAI,WAAW,iBAAiB;YACnC,MAAM,IAAA,2HAAY,EAAC,CAAC;;;;;;;MAOpB,CAAC,EAAE;gBAAC;gBAAQ;gBAAU;gBAAQ;gBAAU;aAAM;YAE9C,MAAM,IAAA,2HAAY,EAAC,CAAC;;;;MAIpB,CAAC,EAAE;gBAAC;gBAAO;gBAAQ;aAAS;QAC9B;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAY;QACnB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;AACF"}}]
}