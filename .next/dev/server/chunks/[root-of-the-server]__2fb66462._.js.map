{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/kleuvyn/Documentos/MeusRepositorios/Calendario_Literario/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL || process.env.POSTGRES_URL,\n  ssl: {\n    rejectUnauthorized: false \n  }\n});\n\nexport async function executeQuery(query: string, params: any[] = []) {\n  try {\n\n    await pool.query('ALTER TABLE users ADD COLUMN IF NOT EXISTS password TEXT;');\n    await pool.query('ALTER TABLE users ADD COLUMN IF NOT EXISTS image TEXT;');\n    await pool.query('ALTER TABLE reading_data ADD COLUMN IF NOT EXISTS author TEXT;');\n    await pool.query('ALTER TABLE reading_data ADD COLUMN IF NOT EXISTS rating INTEGER;');\n    await pool.query('ALTER TABLE reading_data ADD COLUMN IF NOT EXISTS cover_url TEXT;');\n    await pool.query('ALTER TABLE reading_data ADD COLUMN IF NOT EXISTS email TEXT;');\n\n    const result = await pool.query(query, params);\n    return result.rows; \n  } catch (error) {\n    console.error('Erro detalhado no Banco de Dados:', error);\n    throw error;\n  }\n}"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY,IAAI,QAAQ,GAAG,CAAC,YAAY;IACtE,KAAK;QACH,oBAAoB;IACtB;AACF;AAEO,eAAe,aAAa,KAAa,EAAE,SAAgB,EAAE;IAClE,IAAI;QAEF,MAAM,KAAK,KAAK,CAAC;QACjB,MAAM,KAAK,KAAK,CAAC;QACjB,MAAM,KAAK,KAAK,CAAC;QACjB,MAAM,KAAK,KAAK,CAAC;QACjB,MAAM,KAAK,KAAK,CAAC;QACjB,MAAM,KAAK,KAAK,CAAC;QAEjB,MAAM,SAAS,MAAM,KAAK,KAAK,CAAC,OAAO;QACvC,OAAO,OAAO,IAAI;IACpB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qCAAqC;QACnD,MAAM;IACR;AACF"}},
    {"offset": {"line": 162, "column": 0}, "map": {"version":3,"sources":["file:///home/kleuvyn/Documentos/MeusRepositorios/Calendario_Literario/lib/auth.ts"],"sourcesContent":["import { NextAuthOptions } from \"next-auth\";\nimport GoogleProvider from \"next-auth/providers/google\";\nimport CredentialsProvider from \"next-auth/providers/credentials\";\nimport { executeQuery } from \"@/lib/db\";\nimport bcrypt from \"bcrypt\";\n\nexport const authOptions: NextAuthOptions = {\n  providers: [\n    GoogleProvider({\n      clientId: process.env.GOOGLE_CLIENT_ID!,\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\n      authorization: { params: { prompt: \"select_account\" } },\n      allowDangerousEmailAccountLinking: true, \n    }),\n    CredentialsProvider({\n      name: \"Credentials\",\n      credentials: {\n        email: { label: \"Email\", type: \"text\" },\n        password: { label: \"Password\", type: \"password\" }\n      },\n      async authorize(credentials) {\n        if (!credentials?.email || !credentials?.password) return null;\n        const users = await executeQuery(\"SELECT * FROM users WHERE email = $1\", [credentials.email]) as any[];\n        const user = users[0];\n        if (user && user.password && await bcrypt.compare(credentials.password, user.password)) {\n          return { id: user.id.toString(), name: user.name, email: user.email, image: user.image };\n        }\n        return null;\n      }\n    }),\n  ],\n  callbacks: {\n    async jwt({ token, user }) {\n      if (user) token.id = user.id;\n      return token;\n    },\n    async session({ session, token }) {\n      if (session.user) (session.user as any).id = token.id;\n      return session;\n    },\n    async signIn({ user, account }) {\n      if (account?.provider === \"google\") {\n        await executeQuery(\n          `INSERT INTO users (name, email, image) VALUES ($1, $2, $3) \n           ON CONFLICT (email) DO UPDATE SET name = $1`, \n          [user.name, user.email, user.image]\n        );\n      }\n      return true;\n    }\n  },\n  session: { strategy: \"jwt\" },\n  secret: process.env.NEXTAUTH_SECRET,\n  pages: { signIn: '/' }\n};"],"names":[],"mappings":";;;;AACA;AACA;AACA;AACA;;;;;;;;;AAEO,MAAM,cAA+B;IAC1C,WAAW;QACT,IAAA,gKAAc,EAAC;YACb,UAAU,QAAQ,GAAG,CAAC,gBAAgB;YACtC,cAAc,QAAQ,GAAG,CAAC,oBAAoB;YAC9C,eAAe;gBAAE,QAAQ;oBAAE,QAAQ;gBAAiB;YAAE;YACtD,mCAAmC;QACrC;QACA,IAAA,qKAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAO;gBACtC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU,OAAO;gBAC1D,MAAM,QAAQ,MAAM,IAAA,2HAAY,EAAC,wCAAwC;oBAAC,YAAY,KAAK;iBAAC;gBAC5F,MAAM,OAAO,KAAK,CAAC,EAAE;gBACrB,IAAI,QAAQ,KAAK,QAAQ,IAAI,MAAM,gHAAM,CAAC,OAAO,CAAC,YAAY,QAAQ,EAAE,KAAK,QAAQ,GAAG;oBACtF,OAAO;wBAAE,IAAI,KAAK,EAAE,CAAC,QAAQ;wBAAI,MAAM,KAAK,IAAI;wBAAE,OAAO,KAAK,KAAK;wBAAE,OAAO,KAAK,KAAK;oBAAC;gBACzF;gBACA,OAAO;YACT;QACF;KACD;IACD,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM,MAAM,EAAE,GAAG,KAAK,EAAE;YAC5B,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,IAAI,QAAQ,IAAI,EAAE,AAAC,QAAQ,IAAI,CAAS,EAAE,GAAG,MAAM,EAAE;YACrD,OAAO;QACT;QACA,MAAM,QAAO,EAAE,IAAI,EAAE,OAAO,EAAE;YAC5B,IAAI,SAAS,aAAa,UAAU;gBAClC,MAAM,IAAA,2HAAY,EAChB,CAAC;sDAC2C,CAAC,EAC7C;oBAAC,KAAK,IAAI;oBAAE,KAAK,KAAK;oBAAE,KAAK,KAAK;iBAAC;YAEvC;YACA,OAAO;QACT;IACF;IACA,SAAS;QAAE,UAAU;IAAM;IAC3B,QAAQ,QAAQ,GAAG,CAAC,eAAe;IACnC,OAAO;QAAE,QAAQ;IAAI;AACvB"}},
    {"offset": {"line": 256, "column": 0}, "map": {"version":3,"sources":["file:///home/kleuvyn/Documentos/MeusRepositorios/Calendario_Literario/app/api/user/update-profile/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { executeQuery } from \"@/lib/db\";\nimport { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth\";\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const email = searchParams.get(\"email\");\n\n    if (!email) return NextResponse.json({ error: \"Email requerido\" }, { status: 400 });\n\n    // Garante que a coluna existe antes de dar SELECT (Migração \"on-the-fly\")\n    await executeQuery(\"ALTER TABLE users ADD COLUMN IF NOT EXISTS theme TEXT DEFAULT 'rose';\", []);\n\n    const result = await executeQuery(\n      \"SELECT image, theme FROM users WHERE email = $1\",\n      [email]\n    );\n\n    // Se não encontrar o usuário ou o tema for nulo, retorna o padrão 'rose'\n    const userData = result[0] || {};\n    return NextResponse.json({\n      image: userData.image || null,\n      theme: userData.theme || 'rose'\n    });\n  } catch (error) {\n    console.error(\"Erro no GET profile:\", error);\n    return NextResponse.json({ theme: 'rose' }, { status: 200 }); // Retorna rose mesmo no erro para não quebrar o gráfico\n  }\n}\n\nexport async function POST(request: Request) {\n  try {\n    const session = await getServerSession(authOptions);\n    if (!session?.user?.email) return NextResponse.json({ error: \"Não autorizado\" }, { status: 401 });\n\n    const { image, theme } = await request.json();\n\n    if (image) {\n      await executeQuery(\"UPDATE users SET image = $1 WHERE email = $2\", [image, session.user.email]);\n    }\n\n    if (theme) {\n      // Garante que a coluna existe antes de dar UPDATE\n      await executeQuery(\"ALTER TABLE users ADD COLUMN IF NOT EXISTS theme TEXT DEFAULT 'rose';\", []);\n      await executeQuery(\"UPDATE users SET theme = $1 WHERE email = $2\", [theme, session.user.email]);\n    }\n\n    return NextResponse.json({ message: \"Perfil atualizado!\" });\n  } catch (error) {\n    console.error(\"Erro no POST profile:\", error);\n    return NextResponse.json({ error: \"Erro interno\" }, { status: 500 });\n  }\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;;;;;;AAEO,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,QAAQ,aAAa,GAAG,CAAC;QAE/B,IAAI,CAAC,OAAO,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAkB,GAAG;YAAE,QAAQ;QAAI;QAEjF,0EAA0E;QAC1E,MAAM,IAAA,2HAAY,EAAC,yEAAyE,EAAE;QAE9F,MAAM,SAAS,MAAM,IAAA,2HAAY,EAC/B,mDACA;YAAC;SAAM;QAGT,yEAAyE;QACzE,MAAM,WAAW,MAAM,CAAC,EAAE,IAAI,CAAC;QAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,OAAO,SAAS,KAAK,IAAI;YACzB,OAAO,SAAS,KAAK,IAAI;QAC3B;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAO,GAAG;YAAE,QAAQ;QAAI,IAAI,wDAAwD;IACxH;AACF;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,2JAAgB,EAAC,4HAAW;QAClD,IAAI,CAAC,SAAS,MAAM,OAAO,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAiB,GAAG;YAAE,QAAQ;QAAI;QAE/F,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE3C,IAAI,OAAO;YACT,MAAM,IAAA,2HAAY,EAAC,gDAAgD;gBAAC;gBAAO,QAAQ,IAAI,CAAC,KAAK;aAAC;QAChG;QAEA,IAAI,OAAO;YACT,kDAAkD;YAClD,MAAM,IAAA,2HAAY,EAAC,yEAAyE,EAAE;YAC9F,MAAM,IAAA,2HAAY,EAAC,gDAAgD;gBAAC;gBAAO,QAAQ,IAAI,CAAC,KAAK;aAAC;QAChG;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAqB;IAC3D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;AACF"}}]
}