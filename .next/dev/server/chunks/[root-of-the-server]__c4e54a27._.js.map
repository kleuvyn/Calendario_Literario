{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/kleuvyn/Documentos/MeusRepositorios/Calendario_Literario/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL || process.env.POSTGRES_URL,\n  ssl: {\n    rejectUnauthorized: false \n  }\n});\n\nexport async function executeQuery(query: string, params: any[] = []) {\n  try {\n\n    await pool.query('ALTER TABLE users ADD COLUMN IF NOT EXISTS password TEXT;');\n    await pool.query('ALTER TABLE users ADD COLUMN IF NOT EXISTS image TEXT;');\n    await pool.query('ALTER TABLE reading_data ADD COLUMN IF NOT EXISTS author TEXT;');\n    await pool.query('ALTER TABLE reading_data ADD COLUMN IF NOT EXISTS rating INTEGER;');\n    await pool.query('ALTER TABLE reading_data ADD COLUMN IF NOT EXISTS cover_url TEXT;');\n    await pool.query('ALTER TABLE reading_data ADD COLUMN IF NOT EXISTS email TEXT;');\n\n    const result = await pool.query(query, params);\n    return result.rows; \n  } catch (error) {\n    console.error('Erro detalhado no Banco de Dados:', error);\n    throw error;\n  }\n}"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY,IAAI,QAAQ,GAAG,CAAC,YAAY;IACtE,KAAK;QACH,oBAAoB;IACtB;AACF;AAEO,eAAe,aAAa,KAAa,EAAE,SAAgB,EAAE;IAClE,IAAI;QAEF,MAAM,KAAK,KAAK,CAAC;QACjB,MAAM,KAAK,KAAK,CAAC;QACjB,MAAM,KAAK,KAAK,CAAC;QACjB,MAAM,KAAK,KAAK,CAAC;QACjB,MAAM,KAAK,KAAK,CAAC;QACjB,MAAM,KAAK,KAAK,CAAC;QAEjB,MAAM,SAAS,MAAM,KAAK,KAAK,CAAC,OAAO;QACvC,OAAO,OAAO,IAAI;IACpB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qCAAqC;QACnD,MAAM;IACR;AACF"}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":["file:///home/kleuvyn/Documentos/MeusRepositorios/Calendario_Literario/app/api/books/%5Bid%5D/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { executeQuery } from \"@/lib/db\";\n\nexport async function PATCH(\n  request: Request,\n  { params }: { params: any }\n) {\n  try {\n    const { id } = await params;\n    const { title: newName } = await request.json();\n\n    const currentData = await executeQuery(\n      \"SELECT book_name, user_id, email FROM public.reading_data WHERE id = $1\",\n      [id]\n    ) as any[];\n\n    if (!currentData || currentData.length === 0) {\n      return NextResponse.json({ error: \"Não encontrado\" }, { status: 404 });\n    }\n\n    const { book_name: oldName, user_id: userId, email } = currentData[0];\n\n    await executeQuery(\n      `UPDATE public.reading_data SET book_name = $1 WHERE id = $2`,\n      [newName, id]\n    );\n\n    if (userId) {\n      try {\n        await executeQuery(\n          `UPDATE public.book_reviews SET title = $1 WHERE title = $2 AND user_id = $3`,\n          [newName, oldName, userId]\n        );\n      } catch (e) { console.error(\"Erro ao atualizar reviews:\", e); }\n    }\n\n    if (email) {\n      try {\n        await executeQuery(\n          `UPDATE public.books SET title = $1 WHERE title = $2 AND user_email = $3`,\n          [newName, oldName, email]\n        );\n      } catch (e) {\n        console.log(\"Falha ao atualizar tabela books (user_email não existe), tentando 'email'...\");\n        try {\n          await executeQuery(\n            `UPDATE public.books SET title = $1 WHERE title = $2 AND email = $3`,\n            [newName, oldName, email]\n          );\n        } catch (e2) {\n          console.error(\"A tabela 'books' não possui coluna de email conhecida.\");\n        }\n      }\n    }\n\n    return NextResponse.json({ success: true });\n  } catch (error: any) {\n    return NextResponse.json({ error: error.message }, { status: 500 });\n  }\n}\n\nexport async function DELETE(\n  request: Request,\n  { params }: { params: any }\n) {\n  try {\n    const { id } = await params;\n\n    const data = await executeQuery(\n      \"SELECT book_name, user_id, email FROM public.reading_data WHERE id = $1\",\n      [id]\n    ) as any[];\n\n    if (data && data.length > 0) {\n      const { book_name, user_id, email } = data[0];\n\n      await executeQuery(\"DELETE FROM public.reading_data WHERE id = $1\", [id]);\n\n      try {\n        await executeQuery(\"DELETE FROM public.book_reviews WHERE title = $1 AND user_id = $2\", [book_name, user_id]);\n      } catch (e) {}\n      \n      try {\n        await executeQuery(\"DELETE FROM public.books WHERE title = $1 AND (email = $2 OR user_email = $2)\", [book_name, email]);\n      } catch (e) {}\n    }\n\n    return NextResponse.json({ message: \"Excluído com sucesso\" });\n  } catch (error: any) {\n    return NextResponse.json({ error: error.message }, { status: 500 });\n  }\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;;;;;;;AAEO,eAAe,MACpB,OAAgB,EAChB,EAAE,MAAM,EAAmB;IAE3B,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,EAAE,OAAO,OAAO,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE7C,MAAM,cAAc,MAAM,IAAA,2HAAY,EACpC,2EACA;YAAC;SAAG;QAGN,IAAI,CAAC,eAAe,YAAY,MAAM,KAAK,GAAG;YAC5C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,MAAM,EAAE,WAAW,OAAO,EAAE,SAAS,MAAM,EAAE,KAAK,EAAE,GAAG,WAAW,CAAC,EAAE;QAErE,MAAM,IAAA,2HAAY,EAChB,CAAC,2DAA2D,CAAC,EAC7D;YAAC;YAAS;SAAG;QAGf,IAAI,QAAQ;YACV,IAAI;gBACF,MAAM,IAAA,2HAAY,EAChB,CAAC,2EAA2E,CAAC,EAC7E;oBAAC;oBAAS;oBAAS;iBAAO;YAE9B,EAAE,OAAO,GAAG;gBAAE,QAAQ,KAAK,CAAC,8BAA8B;YAAI;QAChE;QAEA,IAAI,OAAO;YACT,IAAI;gBACF,MAAM,IAAA,2HAAY,EAChB,CAAC,uEAAuE,CAAC,EACzE;oBAAC;oBAAS;oBAAS;iBAAM;YAE7B,EAAE,OAAO,GAAG;gBACV,QAAQ,GAAG,CAAC;gBACZ,IAAI;oBACF,MAAM,IAAA,2HAAY,EAChB,CAAC,kEAAkE,CAAC,EACpE;wBAAC;wBAAS;wBAAS;qBAAM;gBAE7B,EAAE,OAAO,IAAI;oBACX,QAAQ,KAAK,CAAC;gBAChB;YACF;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAY;QACnB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;AACF;AAEO,eAAe,OACpB,OAAgB,EAChB,EAAE,MAAM,EAAmB;IAE3B,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QAErB,MAAM,OAAO,MAAM,IAAA,2HAAY,EAC7B,2EACA;YAAC;SAAG;QAGN,IAAI,QAAQ,KAAK,MAAM,GAAG,GAAG;YAC3B,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC,EAAE;YAE7C,MAAM,IAAA,2HAAY,EAAC,iDAAiD;gBAAC;aAAG;YAExE,IAAI;gBACF,MAAM,IAAA,2HAAY,EAAC,qEAAqE;oBAAC;oBAAW;iBAAQ;YAC9G,EAAE,OAAO,GAAG,CAAC;YAEb,IAAI;gBACF,MAAM,IAAA,2HAAY,EAAC,iFAAiF;oBAAC;oBAAW;iBAAM;YACxH,EAAE,OAAO,GAAG,CAAC;QACf;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAuB;IAC7D,EAAE,OAAO,OAAY;QACnB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;AACF"}}]
}